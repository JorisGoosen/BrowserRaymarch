<!DOCTYPE html>
<html>
<head>
<title>Joris Goosen's little corner of the Internet.</title>
<link rel="stylesheet" type="text/css" href="stijl.css">
<link rel="shortcut icon" href="favicon.ico">
</head>
<body>

<canvas id="kleurtjes" width="512" height="512" onclick="drawrandompicture();">
Aah.. It appears your browser does not support WebGL or a canvas.. Sorry about that!
</canvas>

<a href=# onclick="fullScreen(document.getElementById('kleurtjes'));"><div id="volcolcontrol"><p class="box">Click here for fullscreen rendering.</p></div></a>


<a href=# onclick="drawrandompicture();"><div id="volcolinfo"><p class="box">Click here or on it to regenerate the image.</p></div></a>

<div id="menu"><b><ul>
<li><a href="index.html" class="menuitem">Welcome Page</a></li>
<li><a href="thesis.html" class="menuitem">Bachelor Thesis</a></li>
<li><a href="https://www.youtube.com/channel/UCdLLHhFVvFGs4mjXqvtIoTw/videos" class="menuitem">My Youtube Channel</a></li>
<li><a href="pathshots.html" class="menuitem">Pathtraced Render Glory</a></li>
<li><a href="colourshots.html" class="menuitem">Colourful Volumes Galore</a></li>
<li><a href="pingpong.html" class="menuitem">Ping-Ponging with Shaders</a></li>
</ul></b></div>

<div id="menu2"><b><ul>
<li><a href="kanvas.html" class="menuitem">Plantjes!</a></li>	
<li><a href="planeetshots.html" class="menuitem">Planetoide</a></li>	
<li><a href="Veer.html" class="menuitem">Veren!</a></li>
</ul></b></div>

<div style="display:block; margin-top: 1024px"></div>
</body>

<script id="kleur-vert" type="x-shader/x-vertex">
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif


attribute vec3 position;
attribute vec2 uv;

uniform float fov_y_scale;
uniform float aspect;

varying vec3 startpoint;
varying vec3 curraydir;

	

void main(void)
{ 
    startpoint=vec3(0, 0, 0.0);
    curraydir = normalize(vec3(uv.x * fov_y_scale * aspect, uv.y * fov_y_scale, -1.0));

	gl_Position = vec4(position, 1.);
}
</script>

<script id="kleur-frag" type="x-shader/x-fragment">
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

varying vec3 startpoint;
varying vec3 curraydir;


float sphere0(vec3 p)
{

	const float sphereradius = 3.5;
	const vec3 spherePos = vec3(0.0, 0.0, -4.0);

    return length(p - spherePos) - sphereradius;
}
/*
vec3 col(vec3 p)
{
    return vec3(sin(p.x * 3.142) * 0.5f + 0.5f, sin(p.y * 3.142) * 0.5f + 0.5f, sin(p.z * 3.142) * 0.5f + 0.5f);
}
*/

float getDist(vec3 p)
{
	return sphere0(p);
}

vec3 getNormal(vec3 p, float r)
{
	vec3 	L = p + vec3( -r, 0.0, 0.0),
			R = p + vec3(  r, 0.0, 0.0),
			U = p + vec3(0.0,  -r, 0.0),
			D = p + vec3(0.0, 	r, 0.0),
			F = p + vec3(0.0, 0.0,   r),
			B = p + vec3(0.0, 0.0,  -r);

	return normalize(vec3(getDist(R) - getDist(L), getDist(D) - getDist(U), getDist(F) - getDist(B)));
}


vec4 march()
{
    vec3 	p = startpoint;
  	float 	t = 0.0,
			d;

	const float eps = 0.001;  
	
	
	for(int safetyCount = 0; safetyCount < 60; safetyCount++)
    {
		d  = getDist(p);
        p += curraydir * d;
		t += max(0.0, d);
		
		const float tmax = 40.0;

		if(d <= eps)
			return vec4(-1.0 * dot(getNormal(p, 1.0), curraydir));
			//vec4(abs(dot(getNormal(p, eps), curraydir)));//vec4(1.2 - (t / tmax));  //col(startpoint + (t * curraydir)), 1.0);
			
		if(t > tmax)
			return vec4(0);
	}

    return vec4(0.0);
}

void main()
{
	gl_FragColor = march();
}
</script>

<script type="text/javascript" src="webgl-utils.js"></script>
<script type="text/javascript">
	var canvas=null;
	var gl;
	var VOLSHADER;
	var VIEWPORT_VERTEX;
	var VIEWPORT_FACES;
	var _position;
    var _uv;
	
	
	document.addEventListener("fullscreenchange", fsswitch);
	document.addEventListener("webkitfullscreenchange", fsswitch);
	document.addEventListener("mozfullscreenchange", fsswitch);
	document.addEventListener("MSFullscreenChange", fsswitch);
	
	function getRandomInt(min, max) {
		return Math.floor(Math.random() * (max - min)) + min;
	}
	
	function fsswitch()
	{
		justswitched=true;
		drawrandompicture();
	}
	
	function drawrandompicture()
	{
		var fullscreenEnabled = false;
		
		if (
		    document.fullscreenElement ||
		    document.webkitFullscreenElement ||
		    document.mozFullScreenElement ||
		    document.msFullscreenElement
		)  fullscreenEnabled=true;

		
		if(!fullscreenEnabled)
		{
			canvas.width  = 512;
  			canvas.height = 512;
  			document.getElementById("kleurtjes").removeAttribute('style');

		}else{
			canvas.width  = window.innerWidth;
  			canvas.height = window.innerHeight;
  			document.getElementById("kleurtjes").style.top=0;
  			document.getElementById("kleurtjes").style.left=0;
		}
		
		gl.viewport(0,0,canvas.width,canvas.height);
		gl.clearColor(0.0,0.0,0.0,1.0);
		gl.clear(gl.COLOR_BUFFER_BIT);
		
		gl.useProgram(VOLSHADER);
		
		gl.uniform1f(gl.getUniformLocation(VOLSHADER,"fov_y_scale"),2.45);
		gl.uniform1f(gl.getUniformLocation(VOLSHADER,"aspect"),canvas.width/canvas.height);		
				
		gl.bindBuffer(gl.ARRAY_BUFFER, VIEWPORT_VERTEX);
		gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, VIEWPORT_FACES);

		gl.vertexAttribPointer(_position,   3, gl.FLOAT, false, 4*(3+2), 0) ;
        gl.vertexAttribPointer(_uv,         2, gl.FLOAT, false, 4*(3+2), 3 * 4) ;


		gl.drawElements(gl.TRIANGLES, 2*3, gl.UNSIGNED_SHORT, 0);
		
		gl.flush();
	}
	
	window.onload = init;
	
	function init() {
	
		canvas = document.getElementById("kleurtjes");
		console.log(canvas);
		gl=WebGLUtils.setupWebGL(canvas,{ antialias: false, depth: false, alpha: true });
		console.log(gl);
		
		if(!gl) {alert("WebGL does not work!");}
		
		gl.viewport(0,0,canvas.width,canvas.height);
		gl.clearColor(0.1,0.1,0.1,1.0);
		gl.clear(gl.COLOR_BUFFER_BIT);
		
		VOLSHADER=gl.createProgram();
		var vertshadesourceobj=document.getElementById("kleur-vert");
		var fragshadesourceobj=document.getElementById("kleur-frag");
		var vertshader=gl.createShader(gl.VERTEX_SHADER);
		var fragshader=gl.createShader(gl.FRAGMENT_SHADER);
		gl.shaderSource(vertshader, vertshadesourceobj.text);
		gl.shaderSource(fragshader, fragshadesourceobj.text);
		gl.compileShader(vertshader);
		gl.compileShader(fragshader);
				
		gl.attachShader(VOLSHADER, vertshader);
		gl.attachShader(VOLSHADER, fragshader);
		gl.linkProgram(VOLSHADER);

		var compiled 		= gl.getShaderParameter(fragshader, gl.COMPILE_STATUS);
		var compilationLog 	= gl.getShaderInfoLog(fragshader);
		
		console.log('Shader compiled successfully: ' 	+ compiled);
		console.log('Shader compiler log: ' 			+ compilationLog);
		
		_position   = gl.getAttribLocation(VOLSHADER, "position");
        _uv         = gl.getAttribLocation(VOLSHADER, "uv");

		
		gl.enableVertexAttribArray(_position);
        gl.enableVertexAttribArray(_uv);

		
		
		
		
		var viewport_vertex=[
		-1, 1, 0, -1,  1,
		-1,-1, 0, -1, -1,
		 1,-1, 0,  1, -1,
		 1, 1, 0,  1,  1];

		VIEWPORT_VERTEX= gl.createBuffer ();
		gl.bindBuffer(gl.ARRAY_BUFFER, VIEWPORT_VERTEX);
		gl.bufferData(gl.ARRAY_BUFFER,    new
		Float32Array(viewport_vertex), gl.STATIC_DRAW);
		
		var viewport_faces = [
		0,1,2,
		0,2,3];


		VIEWPORT_FACES= gl.createBuffer ();
		gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, VIEWPORT_FACES);
		gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new
		Uint16Array(viewport_faces), gl.STATIC_DRAW);
		
		drawrandompicture();

	}
	
	function fullScreen(element) {
	
	if(element.requestFullscreen) {

		element.requestFullscreen();

	} else if(element.webkitRequestFullscreen ) {

		element.webkitRequestFullscreen();

	} else if(element.mozRequestFullScreen) {

		element.mozRequestFullScreen();

	}

	}
</script>
</html> 
